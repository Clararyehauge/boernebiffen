---
import Heading from "./Heading.astro";
const { title = "" } = Astro.props;
---

<section class="p-8 bg-top h-110 cardcontainer" style="background-image: url('/cardbg.png')">
  <div class="ml-1 mt-8 mb-3">
    <Heading htmlheading="h2" size="medium" font="sans" stylingclasses="font-bold text-[10px] md:text-[30px]">
      {title}
    </Heading>
  </div>

  <!-- HORIZONTAL SCROLL AREA -->
  <div class="scroll-area flex flex-nowrap gap-8 overflow-x-auto overflow-y-hidden pr-5 pl-1 snap-x" style="scroll-behavior:smooth;">
    <slot />
  </div>

  <style>
    /* Gælder for direkte børn i hver .scroll-area - sikrer at der bliver noget at scrolle */
    .scroll-area > * {
      min-width: 260px;
      flex-shrink: 0;
    }
    /* valgfrit: skjul native scrollbar hvis du bruger custom track */
    .scroll-area::-webkit-scrollbar {
      height: 8px;
    }
    .scroll-area::-webkit-scrollbar-thumb {
      background: rgba(0, 0, 0, 0.12);
      border-radius: 999px;
    }
  </style>

  <div class="relative mt-4 h-8 container-track">
    <div class="track absolute left-0 right-0 top-3 h-2 bg-secondary-400 rounded-full shadow-inner"></div>

    <!-- Sæt bee-src til din uploadede fil (lokal path vist i din session) -->
    <img class="bee scale-150 absolute top-0 left-0 w-10 h-10 pointer-events-none" src="/bee.svg" alt="bee" style="transform: translateX(0); transition: transform 120ms linear;" />
  </div>

  <!-- CLIENT-SIDE SCRIPT: binder én bee/track per scroll-area -->
  <script type="module">
    document.addEventListener("DOMContentLoaded", () => {
      // find alle instanser i dokumentet
      const instances = document.querySelectorAll(".cardcontainer");

      instances.forEach((inst) => {
        const scrollArea = inst.querySelector(".scroll-area");
        const bee = inst.querySelector(".bee");
        const track = inst.querySelector(".track");

        if (!scrollArea || !bee || !track) return;

        function updateBee() {
          const maxScroll = Math.max(1, scrollArea.scrollWidth - scrollArea.clientWidth);
          const scrollPercent = scrollArea.scrollLeft / maxScroll;

          const beeWidth = bee.getBoundingClientRect().width;
          const trackWidth = Math.max(0, track.clientWidth - beeWidth);

          const beeX = scrollPercent * trackWidth;
          bee.style.transform = `translateX(${beeX}px)`;
        }

        // initial position
        updateBee();

        // events
        scrollArea.addEventListener("scroll", updateBee);
        window.addEventListener("resize", updateBee);

        // klik på track for at hoppe derhen
        track.addEventListener("click", (e) => {
          const rect = track.getBoundingClientRect();
          const clickX = e.clientX - rect.left;
          const targetPercent = clickX / rect.width;
          const maxScroll = Math.max(0, scrollArea.scrollWidth - scrollArea.clientWidth);
          scrollArea.scrollTo({ left: targetPercent * maxScroll, behavior: "smooth" });
        });
      });
    });
  </script>
</section>
